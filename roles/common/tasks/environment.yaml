---

- name: check if mandatory variables are defined
  assert:
    that:
      - _given is defined
      - _given.dst is defined
      - _given.src is defined
      - pre.backup is defined


- name: check if configuration path exists
  stat:
    path: "{{ _given.dst | dirname }}"
  register: check_path


- name: check if environment file exists
  stat:
    path: "{{ _given.dst }}"
  register: check_name
  when: check_path.stat.exists


- name: create environment file path
  file:
    path: "{{ _given.dst | dirname }}"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
  when: not check_path.stat.exists


- name: check if role environment exists
  stat:
    path: "{{ playbook_dir }}/roles/{{ _given.src | default('.nofile') }}"
  register: check_environment
  when: _given.src is search("/files/")


- name: update environment file from roles environment file
  become: "{{ _given.become | default('no') }}"
  template:
    src: "{{ playbook_dir }}/roles/{{ _given.src }}"
    dest: "{{ _given.dst }}"
  when: check_environment.stat is defined and check_environment.stat.exists
