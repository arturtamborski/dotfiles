---

- name: check if mandatory variables are defined
  assert:
    that:
      - given is defined
      - given.packages is defined


- name: install www keys
  apt_key:
    url: "{{ item }}"
    state: present
  with_items: "{{ given.gpgkeys }}"
  when: given.gpgkeys is defined and (item.startswith('http://') or item.startswith('https://'))


- name: install gpg keys
  apt_key:
    keyring:
    keyserver: "{{ item.split('/')[0] }}"
    id: "{{ item.split('/')[1] }}"
  with_items: "{{ given.gpgkeys }}"
  when: given.gpgkeys is defined and (not item.startswith('http://') and not item.startswith('https://'))


- name: install lists
  apt_repository:
    repo: "{{ item }}"
    state: present
  with_items: "{{ given.lists }}"
  when: given.lists is defined


- name: update cache
  apt:
    update_cache: yes
  when: given.lists is defined


- name: install packages
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ given.packages }}"
